<!DOCTYPE html>  <html> <head>   <title>lelylan-node.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               lelylan-node.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Node.js client library for <a href="http://dev.lelylan.com/">Lelylan</a></strong></p>

<p><strong><a href="https://github.com/lelylan/lelylan-node">View on Github &rarr;</a></strong></p>

<p>Lelylan Node makes it easy for developers to monitor and control all resources defined
in Lelylan providing a simple, self descriptive and consistent representation of them.</p>

<h2>Getting started</h2>

<h3>Installation</h3>

<pre><code>npm install lelylan-node
</code></pre>

<h3>Get an access token</h3>

<p>To start using lelylan you need to get an Access Token using
<a href="http://andreareginato.github.com/simple-oauth2">Simple OAuth2</a>.
If you are not familiar with OAuth2 learn more on
<a href="http://dev.lelylan.com/api/oauth">Lelylan Dev Center</a>.</p>

<p>The following example shows how to get an aceess token using the authorization code flow.</p>

<pre><code>// Set the client credentials
var credentials = { client: {
  id: '&lt;client-id&gt;',
  secret: '&lt;client-secret&gt;',
  site: 'http://people.lelylan.com'
}};

// Initialize the OAuth2 Library
var OAuth2 = require('simple-oauth2')(credentials);

// Authorization OAuth2 URI
var authorization_uri = OAuth2.AuthCode.authorizeURL({
  redirect_uri: 'http://localhost:3000/callback'
});

// Redirect example using Express
// See http://expressjs.com/api.html#res.redirect
res.redirect(authorization_uri);

// Get the access token object (the authorization code is given from the previous step)
var token;
OAuth2.AuthCode.getToken({
  code: 'authorization-code',
  redirectURI: 'http://localhost:3000/callback'
}, function(error, result) { token = result });

// Wrap the access token to automatically refresh when expiring
var token = OAuth2.AccessToken.create(json_token);
</code></pre>

<h3>Lelylan API access</h3>

<p>Once you have the access token you can access to the Lelylan API. The
following example shows how to print in the console a list of owned devices.</p>

<pre><code>// Initialize Lelylan Node library
Lelylan = require('lelylan-node')({ token: token });

// Get all devices
Lelylan.Devices.all(function(error, response) {
  console.log(response)
});
</code></pre>

<h3>Realtime services access</h3>

<p>When using the <a href="http://dev.lelylan.com/api/realtime">subscriptions</a> services (realtime)
you do not need an access token to subscribe to an event. In this
case you need only to set the client credentials.</p>

<pre><code>// Setup credentials
credentials = { client: { id: '&lt;client-id&gt;', secret: '&lt;secret&gt;' } };
Lelylan = require('lelylan-node')(credentials);

// Get all subscriptions
Lelylan.Subscriptions.all(function(error, response) {
  console.log(response)
})
</code></pre>

<h2>Lelylan services</h2>

<h3>Devices</h3>

<p>The Device API defines a set of services to monitor and control every existing device.
Its final goal is to map every device to a unique URI which provides control over it.
<a href="device.html">Learn more</a>.</p>

<h3>History</h3>

<p>When a device updates its properties or executes a function a new history resource with
a snapshot of all device properties is created by Lelylan, also the ones that has not been
updated. This makes it easy to recreate previous device status and extract usage patterns
to improve the way people live their house.
<a href="history.html">Learn more</a>.</p>

<h3>Types</h3>

<p>A type describes the structure of a device. In its simplest form every type can be defined
as the combination of three key elements: properties (what vary during time), functions
(what a device can do), statuses (what a device is in a specific time of its life).
<a href="type.html">Learn more</a>.</p>

<h3>Properties</h3>

<p>A property is whatever vary in a device during time. It can be the intensity in a dimmer,
the temperature in a cooling system or the volume in a television.
<a href="property.html">Learn more</a>.</p>

<h3>Functions</h3>

<p>Functions defines the daily interactions you have with the devices in your house, for
example when you turn on a light, close a door or raise the temperature in a room.
With functions you can control any device in the same way you do everyday of your life.
<a href="function.html">Learn more</a>.</p>

<h3>Statuses</h3>

<p>Properties are not always enough to describe the status of a device. Think at a roller
shutter for example. It has the property aperture that is 100 when open or 0 when closed.
But what if the roller shutter is opening? It is nether open or close. To have a complete
control over the device status in a specific moment of its life is to use the status API.
<a href="status.html">Learn more</a>.</p>

<h3>Locations</h3>

<p>Locations are the places we live in and where physical devices are placed. Lelylan identifies
three types of locations usually organized in a hierarchical structure: houses, floors and
rooms.
<a href="location.html">Learn more</a>.</p>

<h3>Physical devices</h3>

<p>Physical devices are the real objects you physically interact with everyday of your life
like lights, appliances, alarms and more. To enable the communication between Lelylan and
physical devices they should provide a simple set of web services.
<a href="physical.html">Learn more</a>.</p>

<h3>Subscriptions</h3>

<p>Get real-time updates by subscribing to a resource and its related event.
<a href="subscription.html">Learn more</a>.</p>

<h3>Authenticated User Profile</h3>

<p>Returns extended information for the authenticated user.
<a href="profile.html">Learn more</a>.</p>

<h2>Errors</h2>

<p>Exceptions are raised when a 4xx or 5xx status code is returned.</p>

<pre><code>OAtuh2.HTTPError
</code></pre>

<p>Through the error message attribute you can access the JSON representation based on
HTTP status and error message.</p>

<pre><code>OAuth2.AuthCode.getToken(function(error, token) {
  if (error) { console.log(error.message); }
});
</code></pre>

<p>Learn more about <a href="http://dev.lelylan.com/api/core#errors">Error Representations on Lelylan</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Configurations</h2>

<p>Lelylan Configuration accepts an object with the following valid params.</p>

<ul>
<li><code>token</code> - A <a href="http://andreareginato.github.com/simple-oauth2/access-token.html">Simple OAuth2 AccessToken</a> object.</li>
<li><code>client.id</code> - A string that represents the registered Client ID.</li>
<li><code>client.secret</code> - A string that represents the registered Client secret.</li>
<li><code>endpoint</code> - A string that represents the API endpoint (api.lelylan.com by deafault).</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">appConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">function</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">appConfig</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">config</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">config</span> <span class="o">=</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span> <span class="nx">o2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">o2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">],</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span> <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span> <span class="p">}</span> <span class="p">}</span>
      <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">o1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;Device&#39;</span>       <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/device&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;History&#39;</span>      <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/history&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Type&#39;</span>         <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/type&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Property&#39;</span>     <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/property&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Function&#39;</span>     <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/function&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Status&#39;</span>       <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/status&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Location&#39;</span>     <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/location&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Physical&#39;</span>     <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/physical&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Subscription&#39;</span> <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/subscription&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Profile&#39;</span>      <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/profile&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;config&#39;</span>       <span class="o">:</span> <span class="nx">config</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 